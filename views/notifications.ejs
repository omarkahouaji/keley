    <!doctype html>
<html data-ng-app="App">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Notifications</title>

<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/style.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/normalize.css">
<link rel="stylesheet" href="/css/basic-styles.css" media="screen">
<link rel="stylesheet" href="/css/header.css" media="screen">
<link rel="stylesheet" href="/css/okayNav.css" media="screen">
<link rel="stylesheet" href="/css/default.date.css" media="screen">
<link rel="stylesheet" href="/css/default.css" media="screen">



  
<script src="/js/jquery.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/legacy.js"></script>
<script src="/js/canvas-to-blob.min.js"></script>
<script src="/js/fileinput.js"></script>
<script src="/js/bootstrap-tagsinput.js"></script>
<script src="/js/angular.min.js"></script>

<script src="/js/highcharts.js"></script>
<script src="/js/ng-infinite-scroll.js"></script>
<script src="/js/exporting.js"></script>
<!--okayNav-->
<script src="/js/jquery.okayNav.js"></script>
<!--moment-->
<script src="/js/moment.js"></script>
<script src="/js/moment-with-locales.js"></script>




<script type="text/javascript">
    var iApp = angular.module("App", ['infinite-scroll']);
    iApp.controller('DemoController', function($scope, Reddit) {
      $scope.reddit = new Reddit();
      $scope.formatDate=function(date){
        return moment(date).locale('fr').fromNow();
      }
    });

 iApp.factory('Reddit', function($http) {
    var Reddit = function() {
    this.notifications = [];
    this.busy = false;
    this.after = 0;
    };
    Reddit.prototype.nextPage = function() {
    if (this.busy) return;
    this.busy = true;
    var url = "/getNotifications/"+<%-informations.id_user%>+"/" + this.after;
    $http.get(url).success(function(data) {
    var notifications =data.data;

        for (var i = 0; i < notifications.length; i++) {
    this.notifications.push(notifications[i]);
    }
 
    this.after = this.notifications.length - 1+10;
    this.busy = false;
    }.bind(this));
    };
    return Reddit;
    });
</script>
</head>
<body class="search" data-ng-controller="DemoController">

<%- include layouts/header.ejs %>

     <main>
        <div class="container">
        <div class="row">
        <div class="box-search col-lg-7 col-lg-offset-1">
        <span class="box-title">Notifications</span>
        <div infinite-scroll='reddit.nextPage()' infinite-scroll-disabled='reddit.busy' infinite-scroll-distance='0'  >
            <div class=" notification row " style="margin:0px -15px"  ng-repeat="notif in reddit.notifications" ng-class="notif.is_read==0 ? 'read' : '' ">


                <div ng-if="notif.notif_type=='0'">
                <div class=" pull-left ">
                    <a a ng-href="/{{notif.sender.id_user}}/informations"><img ng-src="{{notif.sender.avatar == 'no_avatar' &&  '/images/default.svg' || '<%=path_avatar%>'+notif.sender.id_user+'/'+notif.sender.avatar }}"></a>
                    <a ng-href="/{{notif.sender.id_user}}/informations">{{notif.sender.first_name+" "+notif.sender.last_name+" "}}</a><span>aime votre événement</span><a ng-href="/event/{{notif.event.id_event}}">{{" "+notif.event.title}}</a>

                    <span>{{formatDate(notif.creation_time )}}</span>
                </div> 
                </div>



                <div ng-if="notif.notif_type=='1'">
                <div class=" pull-left">
                    <a a ng-href="/{{notif.sender.id_user}}/informations"><img ng-src="{{notif.sender.avatar == 'no_avatar' &&  '/images/default.svg' || '<%=path_avatar%>'+notif.sender.id_user+'/'+notif.sender.avatar }}" ></a>
                    <a ng-href="/{{notif.sender.id_user}}/informations">{{notif.sender.first_name+" "+notif.sender.last_name+" "}}</a><span>a commenté votre événement</span><a ng-href="/event/{{notif.event.id_event}}">{{" "+notif.event.title}}</a>
                    <span >{{formatDate(notif.creation_time )}}</span>
                </div> 
                </div>

                                <div ng-if="notif.notif_type=='2'">
                <div class=" pull-left">
                    <a a ng-href="/{{notif.sender.id_user}}/informations"><img ng-src="{{notif.sender.avatar == 'no_avatar' &&  '/images/default.svg' || '<%=path_avatar%>'+notif.sender.id_user+'/'+notif.sender.avatar }}"></a>
                    <a a ng-href="/{{notif.sender.id_user}}/informations">{{notif.sender.first_name+" "+notif.sender.last_name+" "}}</a><span>vous a envoyé une demande d'ajout.</span>
                    <span>{{formatDate(notif.creation_time )}}</span>
                </div> 
                </div>

                                                <div ng-if="notif.notif_type=='3'">
                <div class=" pull-left">
                    <a a ng-href="/{{notif.sender.id_user}}/informations"><img ng-src="{{notif.sender.avatar == 'no_avatar' &&  '/images/default.svg' || '<%=path_avatar%>'+notif.sender.id_user+'/'+notif.sender.avatar }}" ></a>
                    <a a ng-href="/{{notif.sender.id_user}}/informations">{{notif.sender.first_name+" "+notif.sender.last_name+" "}}</a><span>a accepté votre demande d'ajout.</span>
                    <span>{{formatDate(notif.creation_time )}}</span>
                </div> 
                </div>


            </div>
               <div ng-show='reddit.busy'>...</div>
            </div>
            </div>


<%- include layouts/activity.ejs %>









        </div>
    </div>
</main>

<script src="js/jquery.js"></script>
<!--build:js js/jquery.okayNav-min.js -->
<script src="js/jquery.okayNav.js"></script>
<!-- endbuild -->

<script type="text/javascript">


      function get() {
       $.ajax({
        url:'/getActivity/<%-informations.id_user%>',
        type: 'GET',
            dataType: 'json',
            success:function(data){
            var json = JSON.parse(data);
            console.log("...");

                $('.activity_content').empty();
                for(i=0;i<json.data.length;i++){


        var src;
        if(json.data[i].avatar=='no_avatar'){
          src = "/images/default.svg";
        }
            
        else{
            src = "<%=path_avatar%>/"+json.data[i].id_user+"/"+json.data[i].avatar;
            srcR = "<%=path_avatar%>/"+json.data[i].sender_id+"/"+json.data[i].avatar;
        }
                            


                  if(json.data[i].type=='2'){
                    $('.activity_content').append(
                      '<div>'+
                      '<img src='+src+' alt="...">'+
                    '<a class="white_link" href="/'+json.data[i].id_friend+'/events"><span>'+json.data[i].first_name+' '+json.data[i].last_name+' et '+json.data[i].friend_first_name+' '+json.data[i].friend_last_name+' sont devenus amis</span></a>'+
                    '<i class=" icon-friends"></i>'+
                  '</div>'
                      )
                  }

                  if(json.data[i].type=='0'){
                    $('.activity_content').append(
                  '<div>'+

                    '<img src='+srcR+' alt="...">'+
                    '<a class="white_link" href="/event/'+json.data[i].event_id+'"><span>'+json.data[i].first_name+' '+json.data[i].last_name+' a aimé l\'événement de '+json.data[i].recipient_first_name+' '+json.data[i].recipient_last_name+'</span></a>'+
                    '<i class=" icon-heart "></i>'+
                  '</div>' 
                      )
                  }

                                    if(json.data[i].type=='1'){
                    $('.activity_content').append(
                  '<div>'+
                   '<img src='+srcR+' alt="...">'+
                    '<a class="white_link" href="/event/'+json.data[i].event_id+'"><span>'+json.data[i].first_name+' '+json.data[i].last_name+' a commenté l\'événement de  '+json.data[i].recipient_first_name+' '+json.data[i].recipient_last_name+'</span></a>'+
                    '<i class=" icon-comment "></i>'+
                  '</div>' 
                      )
                  }

                                                      if(json.data[i].type=='4'){
                    $('.activity_content').append(
                  '<div>'+
                   '<img src='+src+' alt="...">'+
                    '<a class="white_link" href="/event/'+json.data[i].id_event+'"><span>'+json.data[i].first_name+' '+json.data[i].last_name+' a ajouté un nouveau événement</span></a>'+
                    '<i class=" icon-event "></i>'+
                  '</div>' 
                      )
                  }


                                                                        if(json.data[i].type=='3'){
                    $('.activity_content').append(
                  '<div>'+
                   '<img src='+src+' alt="...">'+
                    '<a class="white_link" href="/chart/'+json.data[i].id_chart+'"><span>'+json.data[i].first_name+' '+json.data[i].last_name+' a ajouté une nouvelle courbe</span></a>'+
                    '<i class=" icon-chart "></i>'+
                  '</div>' 
                      )
                  }

                }
}
}) 
}

setInterval(get(),3000);










    var navigation = $('#nav-main').okayNav();
</script>
</body>
</html>
