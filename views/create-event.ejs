<!doctype html>
<html>
<head>
<%- include layouts/head.ejs %>
   <link rel="stylesheet" href="/css/croppie.css" />
   <script src="/js/croppie.js"></script>
   <%- include ../public/js/messages.js %>
</head>
<body class="home create-event-body">
<div class="loading hidden " id="loading">
    <img src="/images/reload.svg">
  <span> la création de votre événement est en cours ...</span>
</div>
  <%- include layouts/header.ejs %>
  <main>
    <div class="container">
      <div class="row">
        <%- include layouts/profileNav.ejs %>
        <div class="  col-md-7">
        <div class="box">
          <span class="box-title">Créer un événement</span>

           <form id="cf" class="form-horizontal" action="/save" method="post" enctype="multipart/form-data" >
            <div class="form-group">
              <label  class="col-sm-offset-1 col-sm-offset-1 col-sm-2 control-label">Title</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" name="title" id="title" autocomplete="off" required>
                <input type="hidden"  name="images_tmp" id="images_tmp">
              </div>
            </div>
            <div class="form-group">
              <label  class="col-sm-offset-1 col-sm-2 control-label">Description</label>
              <div class="col-sm-8">
               <textarea class="form-control" rows="4" name="description" required></textarea>
             </div>
           </div>

           <div class="form-group">
            <label  class="col-sm-offset-1 col-sm-2 control-label">Date</label>
            <div class="input-group col-sm-8" style="padding: 0px 15px">
             <input type="date" id="date" class="form-control datepicker date-style" name="date" required>
             <div class="input-group-addon input-group-addon-create-event"><i class="icon-event icon-date-picker"></i></div>
           </div>
         </div>

         <div class="form-group">
          <label  class="col-sm-offset-1 col-sm-2 control-label">Je note</label>
          <div class="col-sm-8">
            <input type="text" id="event-slider" name="note" value="" />
          </div>
          <span class="note-error"></span>
        </div>
        <div class="form-group">
          <label  class="col-sm-offset-1 col-sm-2 control-label">Courbe</label>
          <div class="col-sm-8">
            <select class="selectpicker" name="courbe">
              <% for(var i=0;i < charts.length;i++){
                if(typeof last_chart !== 'undefined' && charts[i].id_chart == last_chart){ %>
              <option selected data-content="<%=charts[i].title%><i class=<%=iconTab[i]%>></i>" value="<%=parseInt(charts[i].id_chart)%>"></option>
              <% }else{ %>
              <option data-content="<%=charts[i].title%><i class=<%=iconTab[i]%>></i>" value="<%=parseInt(charts[i].id_chart)%>"></option>
              <% }} %>

<!--
              <%  if(type!="0"){
              for(var i=0;i < charts.length;i++) {
              %>
              <option data-content="<%=charts[i].title%><i class=<%=iconTab[i]%>></i>" value="<%=parseInt(charts[i].id_chart)%>"></option>
              <% }}
                else{
               %>
              <option data-content="<%=chart.title%><i class=<%=chart.iconTab%>></i>" value="<%=parseInt(chart.id_chart)%>"></option>
              <%}%>


            -->
            </select>
          </div>
        </div>
        <div class="form-group">
          <label  class="col-sm-offset-1 col-sm-2 control-label">Photos</label>
          <div class="col-sm-8">
          <input id="input-id" class="file" name="file" type="file" multiple></input>
        </div>
        </div>
        <div class="form-group">
              <label  class="col-sm-offset-1 col-sm-2 control-label"></label>
              <div class="col-sm-8">
                <button type="submit" id="btn" name="submit" value="Valider" class="box-button btn btn-default">Ajouter</button>
              </div>
        </div>
            <!--
        <div class="form-group">
        <div class="share social col-sm-offset-2 col-sm-8">
          <button type="submit" class="btn share-fb"><i class="fa fa-facebook"></i><span>Partager</span></button>
          <button type="submit" class="btn share-gp"><i class="fa fa-google-plus"></i><span>Partager</span></button>
        </div>
        </div>
      -->
      </form>
    </div>
  </div>
</div>
</div>
<div id="datepicker-container"></div>
</main>









<%- include ../public/js/crop_avatar.js %>
<script type="text/javascript">

var tmp_ids = new Array();
//var data_delete;
$("#input-id").fileinput({
  ShowDelete:false,
  showCaption:false,
    theme:'fa',
    uploadUrl: "/upload_image", // server upload action
    uploadAsync: true,
    browseOnZoneClick: true,
    maxFileCount: 10,
    fileActionSettings:{
      showRemove:false
    }
}).on("filebatchselected", function(event, files) {
    // trigger upload method immediately after files are selected
    $("#input-id").fileinput("upload");
}).on('fileuploaded', function(event, data, msg) {
  var d = JSON.parse(data.response);
  //data_delete = JSON.parse(data.response);
  tmp_ids.push(d.data.data.id_upload);
  $('#images_tmp').val(JSON.stringify(tmp_ids));
});

/*$('#input-id').on('filesuccessremove', function(event) {
var id_delete=data_delete.data.data.id_upload;
var a = tmp_ids.indexOf(id_delete);
delete tmp_ids[a];
  $('#images_tmp').val(JSON.stringify(tmp_ids));
});*/


    var $input = $('.datepicker').pickadate({
        monthsFull: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
        format: 'd mmmm yyyy',
          formatSubmit:'yyyy/mm/dd',
        selectMonths: true,
        hiddenName: true,
        selectYears: 100,
        container: '#datepicker-container',
        onSet:function(){
              document.getElementById('date').value=this.get();
              $('.picker').appendTo('body');
        }
    });

    var picker = $input.pickadate('picker')
    $('.icon-date-picker').click(function(e){
      // stop the click from bubbling
      e.stopPropagation();
      // prevent the default click action
      e.preventDefault();
      // open the date picker
      picker.open();
    })

  var navigation = $('#nav-main').okayNav();
  var isChanged = false;
  $(document).ready(function () {
    $("#event-slider").ionRangeSlider({
     hide_min_max: true,
     type: "single",
     min: 0,
     max: 5,
     from: 2.5,
     step:0.1,
     onChange : function (data) {
      isChanged = true;
      console.log(data.from);
      console.log(isChanged);
      document.getElementById('event-slider').value=data.from;
    },
    onFinish: function (data) {
      console.log(data.from);
      document.getElementById('event-slider').value=data.from;
    }
  });
  });

  $( "form" ).submit(function( event ) {
  if ( isChanged) {
    return;
  }

  $( ".note-error" ).text( "Merci de mettre une note entre 0 et 5" ).show().fadeOut( 3000 );
  event.preventDefault();
});





/*$("#btn").click(function(event){
console.log("omar");

            //event.preventDefault();
             if($("#cf").validate()){
              console.log("omar");
            $("#cf").submit();
          }


});*/



/*$("#form").submit(function(event){
    $('.loading').removeClass('hidden');
    })*/






</script>
<script src="/js/site.js"></script>
</body>
</html>
