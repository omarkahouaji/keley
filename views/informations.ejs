<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-select.css">
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/basic-styles.css" media="screen">
    <link rel="stylesheet" href="/css/header.css" media="screen">
    <link rel="stylesheet" href="/css/okayNav.css" media="screen">
    <link rel="stylesheet" href="/css/default.date.css" media="screen">
    <link rel="stylesheet" href="/css/default.css" media="screen">
    <link rel="stylesheet" href="/css/bootstrap-tagsinput.css" media="screen">
    <link rel="stylesheet" href="/css/croppie.css" />
    <link rel="stylesheet" href="/css/flags.css" />
    <link rel="stylesheet" href="/css/fileinput.min.css" media="screen">
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.js"></script>
    <script src="/js/picker.js"></script>
    <script src="/js/legacy.js"></script>
    <script src="/js/picker.date.js"></script>
    <script src="/js/canvas-to-blob.min.js"></script>
    <script src="/js/bootstrap-tagsinput.js"></script>
    <script src="/js/bootstrap3-typeahead.js"></script>
    <script src="/js/jquery.okayNav.js"></script>
    <script src="/js/croppie.js"></script>
    <script src="/js/jquery.flagstrap.js"></script>
    <script src="/js/fileinput.js"></script>

<script type="text/javascript">
    var current_img = '<%=informations.avatar %>' ;
    if( '<%- facebook %>' == 'new user' && current_img == 'no_avatar'){
      $(window).load(function(){
          $('#myModal').modal('show');
      });
    }

    var fb_img = '<%-fb_image%>';
    var user_status = '<%- facebook %>';
</script>
  </head>
  <body class="home">



    <div class="wait hidden " id="wait">
      <div class="col-md-offset-4 col-md-4">
        <img src="/images/reload.svg">
      </div>
      <div class="col-md-offset-4 col-md-4">
        <span> la création de votre événement est en cours ...</span>
      </div>
    </div>
    <%- include layouts/header.ejs %>
    <main>
    <div class="container">
      <div class="row">
        <%- include layouts/profileNav.ejs %>
        
        
        <div class="col-md-7">
          <div class="box  box-top">
            <span class="box-title"></span>
            <form class=" form-horizontal" action="/editProfile" method="post">
              <div class="form-group">
                <label  class="col-md-offset-1 col-sm-2 control-label">Nom*</label>
                <div class="col-sm-7">
                  <input type="text" class="form-control" name="last_name" value="<%=informations.last_name%>">
                </div>
              </div>
              <div class="form-group">
                <label  class="col-md-offset-1 col-sm-2 control-label">Prénom*</label>
                <div class="col-sm-7">
                  <input type="text" class="form-control" name="first_name" value="<%=informations.first_name%>">
                </div>
              </div>
              <div class="form-group">
                <label  class="col-md-offset-1 col-sm-2 control-label">Mobile</label>
                <div class="col-sm-7">
                  <input type="text" class="form-control" name="phone" value="<%=informations.phone%>">
                </div>
              </div>
              <div class="form-group">
                <label  class="col-md-offset-1 col-sm-2 control-label">Email*</label>
                <div class="col-sm-7">
                  <input type="email" class="form-control" name="email" value="<%=informations.email%>" readonly>
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-offset-3 col-sm-6">
                  <input id="male" type="radio" name="sexe" value="male" ><label for="male"><span><span></span></span>Homme</label>
                  <input id="female" type="radio" name="sexe" value="female" ><label for="female"><span><span></span></span>Femme</label>
                </div>
              </div>
              <div class="form-group">
                <label  class="col-md-offset-1 col-sm-2 control-label">Date de naissance</label>
                <div class="col-sm-7">
                  <input type="text" id="date" name="date" class="form-control datepicker date-style" data-value="<%=informations.birthday%>" >
                </div>
              </div>
              <div class="form-group">
                <label  class="col-md-offset-1 col-sm-2 control-label">Ville</label>
                <div class="col-sm-7">
                  <input type="text" class="form-control" name="address" value="<%=informations.address%>">
                </div>
              </div>
              <div class="form-group country">
                <label  class="col-md-offset-1 col-sm-2 control-label">Pays</label>
                <div class="flagstrap col-sm-7" data-input-name="country" data-selected-country="<%=informations.country%>" ></div>
              </div>
              <div class="form-group">
                <label  class="col-md-offset-1 col-sm-2 control-label"></label>
                <div class="col-sm-7">
                  <button type="submit" id="event-form" name="submit" value="Valider" class="box-button btn btn-default informations_btn">Valider</button>
                </div>
              </div>
            </form>

            <div class="informations-line"></div>
            <% if (notaire.msg == false){ %>
            <form class="form-horizontal" action="/addNotaire" method="post" onkeypress="return event.keyCode != 13;">
              <div class="form-group">
                <label  class="col-md-offset-1 col-sm-2 control-label">Notaire</label>
                <div class="col-sm-7" style="margin-bottom:10px">
                  <input type="text" class="form-control" name="last_name" id="last_name" placeholder="Nom">
                </div>
                <div class="col-sm-offset-2 col-md-offset-3 col-sm-7 " >
                  <input type="text" class="form-control" name="first_name" id="first_name" placeholder="Prénom">
                </div>
                <div class="notaire-email col-sm-offset-2 col-md-offset-3 col-sm-7">
                  <input type="text" class="form-control" name="email" id="email" placeholder="Email">
                </div>
              </div>
              <div class="form-group">
                <label  class="col-sm-3 control-label"></label>
                <div class="col-sm-7">
                  <button type="submit" id="notaire" name="submit" value="Valider" class="box-button btn btn-default informations_btn">Valider</button>
                </div>
              </div>
            </form>
            <% } else { %>
            <span>Nom :</span>
            <span><%= notaire.data[0].last_name %></span>
            <span>Prénom :</span>
            <span><%= notaire.data[0].first_name %></span>
            <span>Email :</span>
            <span><%= notaire.data[0].email %></span>
            <% } %>
            <div class="informations-line"></div>
            <div class="form-group leg">
              <label  class="col-md-offset-1 col-sm-2 control-label">Légataire</label>
              <div class="col-sm-7">
                <input type="text"  data-role="tagsinput" class="col-sm-7 form-control typeahead" name="title" id="tag" data-provide="typeahead">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </main>


<script type="text/javascript" src="/js/crop_avatar.js"></script>
<script type="text/javascript">
    $(".file").fileinput({
    showUpload:false,
    showRemove:false,
    showPreview:false,
    showCaption:false
  });





 $('.flagstrap').flagStrap({
   onSelect: function (value, element) {
     value = $(element).children("option[selected=selected]").val(); //This is the correct value
     //Now you can use it
     console.log("This is the selected country code: " + value);
   }
});




//start pick a date
    var $input = $('.datepicker').pickadate({
        monthsFull: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
        format: 'd mmmm yyyy',
          formatSubmit:'yyyy/mm/dd',
        selectMonths: true,
        hiddenName: true,
        selectYears: 100,
        onSet:function(){
              document.getElementById('date').value=this.get();
        }
    });
    //end pick a date



var data = <%-friends%>;
var immortals = JSON.parse('<%-immortals%>');

    var cities = [{"value":1,"text":"Amsterdam","continent":"Europe"},{"value":4,"text":"Washington","continent":"America"},{"value":7,"text":"Sydney","continent":"Australia"},{"value":10,"text":"Beijing","continent":"Asia"},{"value":13,"text":"Cairo","continent":"Africa"}];
    var amis = data;

    /*var d = immortals;
    var immortalsFriends = JSON.stringify(d.data);
    console.log(JSON.parse(immortalsFriends));
    //console.log(JSON.stringify(d.data));*/

        for (var i = 0; i < immortals.length; i++) {
      var a = JSON.stringify(immortals[i]);
      console.log(a);
    }



  $('#tag').tagsinput({

      itemValue: 'id_friend',
 itemText: function(item) {
    //return item.value+' - '+item.text
    return item.first_name+'  '+item.last_name
  },

  typeahead: {
         displayText: function(item) {
    return item
  },
    afterSelect: function(val) { this.$element.val(""); },
    
    source: amis.data
  },
  freeInput: false
});




  for (var i = 0; i < immortals.length; i++) {
      $('#tag').tagsinput('add', immortals[i]);
  }  



        


$('#tag').on('itemAdded', function(event) {
 //start
console.log("start");
        $.ajax({
        url:'/addImmortal',
        type: 'POST',
        data:{
            user_id:<%-informations.id_user%>,
            immortal_id:event.item.id_friend
        },
            dataType: 'json',
            success:function(data){
            console.log("Added !");
}
})  
 //end
 });





$('#tag').on('itemRemoved', function(event) {
 //start
console.log("start");
        $.ajax({
        url:'/deleteImmortal',
        type: 'POST',
        data:{
            user_id:<%-informations.id_user%>,
            immortal_id:event.item.id_friend
        },
            dataType: 'json',
            success:function(data){
                console.log("Removed !");
}
})  
 //end
 });


$('#notaire').click(function(event) {
 //start
        event.preventDefault();
        $.ajax({
          url:'/addNotaire',
          type: 'POST',
          data:{
            user_id:<%-informations.id_user%>,
            first_name:$('#first_name').val(),
            last_name:$('#last_name').val(),
            email:$('#email').val()
          },
          dataType: 'json',
          success:function(data){
            console.log("added !");
            window.location.href = "/informations";
          }
        })  
 //end
 });





    if(<%-informations.sex%>==male){
        $('#male').prop("checked", true);
    }
    else{
        $('#female').prop("checked", true);
    }

    var navigation = $('#nav-main').okayNav();
</script>
</body>
</html>
